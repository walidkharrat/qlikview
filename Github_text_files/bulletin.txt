							//*****************BULLETIN*******************

BULLETIN:
LOAD 
	  MATEMP&'-'&MOIS&'-'&if([ANNEE]='0','2000',
	 	if([ANNEE]='3','2003',
	 	if([ANNEE]='201','2001',
	 	if([ANNEE]='210','2010',
	 	if([ANNEE]='88','2016',
	 		ANNEE))))) as IDPOINTM_EB, 
	 ANNEE AS ANNEEB, 
     MOIS AS MOISB, 
     num(ANNEE)&'-'&num(Month(MOIS))&'-01 00:00:00' as IDMONTHYEARBULLETIN,
     //num(MATEMP) as MATEMP_BL, 
     CODRUB, 
     date(ANNEE&'-'&MOIS&'-01 00:00:00') as DATEBULL, 
     TYPBUL AS TYPBULL, 
     BASE AS BASEL, 
     MONTD, 
     MONTP, 
     MONTSABAT, 
     ABATCP
FROM
[..\QVD\BULLETIN.qvd]
(qvd)
Where ANNEE>=2005
;

TEMPSBULLETIN:
		LOAD Min(DATEBULL) AS MINDATEBULLETIN,
		MAX(DATEBULL) AS MAXDATEBULLETIN
		Resident BULLETIN;
LET VARMINDATEBULLETIN=Num(Peek('MINDATEBULLETIN',0,'TEMPSBULLETIN'));
LET VARMAXDATEBULLETIN=Num(Peek('MAXDATEBULLETIN',0,'TEMPSBULLETIN'));
DROP Table TEMPSBULLETIN;
				
TEMPCALENDERBULLETIN:
LOAD 
		$(VARMINDATEBULLETIN)+IterNo()-1 as NUMBULLETIN,
		Date($(VARMINDATEBULLETIN)+IterNo()-1) as TEMPSDATEBULLETIN
		AUTOGENERATE 1 WHILE $(VARMINDATEBULLETIN)+IterNo()-1 <=$(VARMAXDATEBULLETIN);
MASTERCALENDERBULLETIN :
LOAD TEMPSDATEBULLETIN as ORDERDATEBULLETIN,
Week (TEMPSDATEBULLETIN) AS WEEKBULLETIN,
Year(TEMPSDATEBULLETIN) as YEARBULLETIN,
num(Year (TEMPSDATEBULLETIN))&'-'&num(Month(TEMPSDATEBULLETIN))&'-01 00:00:00' as IDMONTHYEARBULLETIN,
MONTH(TEMPSDATEBULLETIN) as MONTHBULLETIN,
DAY(TEMPSDATEBULLETIN) as DAYBULLETIN,
YearToDate(TEMPSDATEBULLETIN)*-1 as CURRYEARIDFLAGBULLETIN,
YearToDate(TEMPSDATEBULLETIN,-1)*-1 as LASTYEARIDFLAGBULLETIN,
InYear(TEMPSDATEBULLETIN,MonthStart($(VARMAXDATEBULLETIN)),-1) as RC12BULLETIN,
Date(MonthsStart(TEMPSDATEBULLETIN,'MM-YYYY')) AS MONTHYEARBULLETIN,
ApplyMap('QUARTERSMAP',Month(TEMPSDATEBULLETIN),Null()) as QUARTERBULLETIN,
Week(WeekStart(TEMPSDATEBULLETIN))&'-'&WeekYear(TEMPSDATEBULLETIN) as WEEKYEARBULLETIN,
WeekDay(TEMPSDATEBULLETIN) as WEEKDAYBULLETIN
Resident TEMPCALENDERBULLETIN

Order By TEMPSDATEBULLETIN asc;
DROP Table TEMPCALENDERBULLETIN;
